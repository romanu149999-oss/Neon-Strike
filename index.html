<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Meteor Strike: Tactical Edition</title>
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-pink: #ff00ff;
            --neon-purple: #bc13fe;
            --neon-green: #39ff14;
            --neon-yellow: #fbff00;
            --neon-red: #ff3131;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #010103;
            color: white;
            font-family: 'Orbitron', 'Segoe UI', sans-serif;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, #050510 0%, #000 100%);
        }

        canvas {
            display: block;
        }

        /* UI Overlays */
        #ui-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            pointer-events: none;
            z-index: 10;
        }

        .hud-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .neon-label {
            font-size: 10px;
            opacity: 0.7;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .neon-value {
            font-weight: 900;
            font-size: 18px;
            text-shadow: 0 0 10px currentColor;
        }

        #xp-container {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.05);
            margin-top: 15px;
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }

        #xp-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
            box-shadow: 0 0 15px var(--neon-blue);
            transition: width 0.4s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        #upgrade-screen {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .upgrade-grid {
            display: flex;
            gap: 15px;
            padding: 10px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1000px;
            width: 100%;
            overflow-y: auto;
            max-height: 80vh;
        }

        .upgrade-card {
            width: 150px;
            min-height: 240px;
            background: linear-gradient(135deg, rgba(30, 30, 50, 0.9) 0%, rgba(10, 10, 20, 1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            pointer-events: auto;
        }

        .upgrade-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: var(--active-color);
            box-shadow: 0 0 25px var(--shadow-color);
        }

        .upgrade-rarity {
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
            color: var(--active-color);
        }

        .upgrade-icon {
            width: 45px;
            height: 45px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            border: 2px solid var(--active-color);
            font-size: 22px;
            box-shadow: inset 0 0 10px var(--shadow-color);
        }

        .upgrade-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #fff;
        }

        .upgrade-desc {
            font-size: 10px;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.7);
        }

        .upgrade-tier {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 10px;
            font-weight: bold;
            color: rgba(255,255,255,0.3);
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .btn {
            background: transparent;
            color: white;
            border: 2px solid var(--neon-blue);
            padding: 15px 40px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.2s;
            pointer-events: auto;
        }

        .btn:hover {
            background: var(--neon-blue);
            color: black;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .hidden { display: none !important; }

        @media (max-width: 480px) {
            .upgrade-card { width: 120px; min-height: 200px; padding: 10px; }
            .upgrade-title { font-size: 12px; }
            .upgrade-desc { font-size: 9px; }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui-overlay">
            <div class="hud-row">
                <div>
                    <div class="neon-label">Interceptor</div>
                    <div id="pilot-name" class="neon-value" style="color: var(--neon-pink)">---</div>
                    <div class="neon-label" style="margin-top:10px">Combat Data</div>
                    <div id="score-display" class="neon-value" style="color: var(--neon-green)">0</div>
                </div>
                <div style="text-align: right;">
                    <div class="neon-label">Level</div>
                    <div id="level-display" class="neon-value" style="color: var(--neon-blue)">1</div>
                    <div id="lives-display" style="margin-top: 10px; font-size: 20px;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                </div>
            </div>
            <div id="xp-container">
                <div id="xp-fill"></div>
            </div>
        </div>

        <div id="start-screen" class="overlay">
            <h1 style="font-size: clamp(40px, 8vw, 70px); color: var(--neon-blue); margin: 0; text-align: center; letter-spacing: 10px;">NEON STRIKE</h1>
            <p style="opacity: 0.5; margin-bottom: 30px; letter-spacing: 2px;">ELITE SURVIVAL INTERFACE v3.0</p>
            <input type="text" id="player-input" placeholder="PILOT CALLSIGN" maxlength="12" 
                   style="background: transparent; border: 1px solid var(--neon-blue); color: white; padding: 12px; width: 250px; text-align: center; margin-bottom: 10px; outline: none; font-family: inherit;">
            <button id="start-btn" class="btn">ENGAGE SYSTEMS</button>
        </div>

        <div id="upgrade-screen" class="hidden">
            <h2 style="color: var(--neon-purple); letter-spacing: 6px; font-size: 28px; margin-bottom: 20px; text-shadow: 0 0 15px var(--neon-purple);">SYSTEM EVOLUTION</h2>
            <div id="upgrade-grid" class="upgrade-grid"></div>
        </div>

        <div id="game-over-screen" class="overlay hidden">
            <h1 style="color: var(--neon-red); font-size: 48px; letter-spacing: 5px;">MISSION FAILED</h1>
            <div id="final-score" style="font-size: 20px; margin-bottom: 20px; opacity: 0.8;"></div>
            <button id="restart-btn" class="btn">REBOOT SYSTEM</button>
        </div>

        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        const state = {
            active: false,
            paused: false,
            level: 1, xp: 0, xpToNext: 100,
            score: 0, frame: 0,
            lives: 3, maxLives: 3,
            invuln: 0,
            timeScale: 1
        };

        const player = {
            x: 0, y: 0, radius: 15,
            fireRate: 45, bulletSpeed: 14, bulletCount: 1,
            damage: 1, speedMult: 0.12, bulletSize: 4,
            critChance: 0.05,
            pierce: 0,
            upgrades: {} // Track tier of each upgrade
        };

        let bullets = [], enemies = [], stars = [], particles = [];
        let mouseX = 0, mouseY = 0;

        const UPGRADE_DATA = [
            { id: 'fire_rate', title: 'Overclock', desc: 'Increases rate of fire.', icon: '‚ö°', rarity: 'common' },
            { id: 'multishot', title: 'Spreadshot', desc: 'Adds more bullet streams.', icon: 'üõ∞Ô∏è', rarity: 'rare' },
            { id: 'damage', title: 'Heavy Pulse', desc: 'Increases bullet damage.', icon: 'üíé', rarity: 'rare' },
            { id: 'crit', title: 'Neural Aim', desc: 'Higher critical strike chance.', icon: 'üéØ', rarity: 'common' },
            { id: 'pierce', title: 'Railgun Tech', desc: 'Bullets pass through targets.', icon: 'üîÆ', rarity: 'legendary' },
            { id: 'bullet_size', title: 'Plasma Core', desc: 'Massive projectile area.', icon: '‚òÑÔ∏è', rarity: 'common' },
            { id: 'chrono', title: 'Chrono Warp', desc: 'Permanently slows enemies.', icon: '‚è≥', rarity: 'rare' },
            { id: 'nova', title: 'Nova Shield', desc: 'Longer invulnerability window.', icon: 'üõ°Ô∏è', rarity: 'common' },
            { id: 'repair', title: 'Nanites', desc: 'Fully repairs hull.', icon: 'üîß', rarity: 'legendary' }
        ];

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            stars = [];
            for(let i=0; i<120; i++) stars.push({x: Math.random()*width, y: Math.random()*height, s: Math.random()*2, v: Math.random()*3+1});
            if(!state.active) { player.x = width/2; player.y = height*0.8; }
        }
        window.addEventListener('resize', resize);
        resize();

        function getUpgradeDetails(id) {
            const tier = (player.upgrades[id] || 0) + 1;
            const base = UPGRADE_DATA.find(u => u.id === id);
            let desc = base.desc;
            let rarity = base.rarity;

            if (tier > 3) rarity = 'legendary';
            else if (tier > 1) rarity = 'rare';

            if (id === 'fire_rate') desc = `Fire rate +${15 * tier}% (Tier ${tier})`;
            if (id === 'multishot') desc = `Gain +1 extra stream (Tier ${tier})`;
            if (id === 'pierce') desc = `Bullets pierce +${tier} enemies (Tier ${tier})`;

            return { ...base, tier, desc, rarity };
        }

        function showLevelUp() {
            state.paused = true;
            const screen = document.getElementById('upgrade-screen');
            const grid = document.getElementById('upgrade-grid');
            grid.innerHTML = '';
            screen.classList.remove('hidden');
            
            const pool = [...UPGRADE_DATA];
            const choices = [];
            for(let i=0; i<3; i++) {
                const idx = Math.floor(Math.random() * pool.length);
                const base = pool.splice(idx, 1)[0];
                choices.push(getUpgradeDetails(base.id));
            }

            choices.forEach(up => {
                const card = document.createElement('div');
                card.className = 'upgrade-card';
                const colors = { common: '#00f2ff', rare: '#bc13fe', legendary: '#fbff00' };
                const color = colors[up.rarity];
                card.style.setProperty('--active-color', color);
                card.style.setProperty('--shadow-color', color + '55');
                
                card.innerHTML = `
                    <div class="upgrade-tier">T${up.tier}</div>
                    <div class="upgrade-rarity">${up.rarity}</div>
                    <div class="upgrade-icon">${up.icon}</div>
                    <div class="upgrade-title">${up.title}</div>
                    <div class="upgrade-desc">${up.desc}</div>
                `;
                card.onclick = () => {
                    applyUpgrade(up);
                    screen.classList.add('hidden');
                    state.paused = false;
                };
                grid.appendChild(card);
            });
        }

        function applyUpgrade(up) {
            player.upgrades[up.id] = (player.upgrades[up.id] || 0) + 1;
            switch(up.id) {
                case 'fire_rate': player.fireRate *= 0.82; break;
                case 'multishot': player.bulletCount++; break;
                case 'damage': player.damage += 1.5; break;
                case 'crit': player.critChance += 0.08; break;
                case 'pierce': player.pierce++; break;
                case 'bullet_size': player.bulletSize += 2; break;
                case 'chrono': state.timeScale *= 0.9; break;
                case 'nova': state.maxLives++; state.lives++; updateLives(); break;
                case 'repair': state.lives = state.maxLives; updateLives(); break;
            }
        }

        class Bullet {
            constructor(x, y, angle) {
                this.x = x; this.y = y; this.angle = angle;
                this.speed = player.bulletSpeed;
                this.radius = player.bulletSize;
                this.dmg = player.damage;
                this.pierceCount = player.pierce;
                this.hitEnemies = new Set();
                this.isCrit = Math.random() < player.critChance;
                if(this.isCrit) { this.dmg *= 2; this.radius *= 1.5; }
            }
            update() {
                this.x += Math.sin(this.angle) * this.speed;
                this.y -= Math.cos(this.angle) * this.speed;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.fillStyle = this.isCrit ? '#ff00ff' : '#fff';
                ctx.shadowBlur = this.isCrit ? 20 : 10;
                ctx.shadowColor = this.isCrit ? '#ff00ff' : '#00f2ff';
                ctx.beginPath(); ctx.arc(0, 0, this.radius, 0, Math.PI*2); ctx.fill();
                ctx.restore();
            }
        }

        class Enemy {
            constructor() {
                const isHeavy = Math.random() < (0.15 + (state.level * 0.03));
                this.radius = isHeavy ? 40 : 20;
                this.x = Math.random() * (width - 80) + 40;
                this.y = -60;
                this.maxHp = (isHeavy ? 15 : 2) * (1 + (state.level * 0.2));
                this.hp = this.maxHp;
                this.v = (Math.random() * 2 + 2 + (state.level * 0.1)) * state.timeScale;
                this.color = isHeavy ? '#bc13fe' : '#39ff14';
                this.rotation = 0;
                this.rotS = (Math.random() - 0.5) * 0.1;
                this.isHeavy = isHeavy;
            }
            update() { 
                this.y += this.v; 
                this.rotation += this.rotS;
            }
            draw() {
                // Draw Health Bar
                if (this.hp < this.maxHp) {
                    const barWidth = this.radius * 2;
                    const barHeight = 4;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                    ctx.fillRect(this.x - barWidth/2, this.y - this.radius - 12, barWidth, barHeight);
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x - barWidth/2, this.y - this.radius - 12, barWidth * (this.hp / this.maxHp), barHeight);
                }

                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.shadowBlur = 15; ctx.shadowColor = this.color;
                ctx.strokeStyle = this.color; ctx.lineWidth = 3;
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.beginPath();
                if(this.isHeavy) {
                    for(let i=0; i<8; i++) {
                        let a = (i/8)*Math.PI*2;
                        ctx.lineTo(Math.cos(a)*this.radius, Math.sin(a)*this.radius);
                    }
                } else {
                    ctx.moveTo(0, -this.radius);
                    ctx.lineTo(this.radius, this.radius);
                    ctx.lineTo(-this.radius, this.radius);
                }
                ctx.closePath(); ctx.fill(); ctx.stroke();
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 1; ctx.stroke();
                ctx.restore();
            }
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.color = color;
                this.v = { x: (Math.random()-0.5)*10, y: (Math.random()-0.5)*10 };
                this.life = 1.0;
                this.decay = Math.random() * 0.05 + 0.02;
            }
            update() { this.x += this.v.x; this.y += this.v.y; this.life -= this.decay; }
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, 3, 3);
                ctx.globalAlpha = 1;
            }
        }

        function spawnEnemy() {
            if(state.active && !state.paused) enemies.push(new Enemy());
            const delay = Math.max(300, 1300 - (state.level * 80));
            setTimeout(spawnEnemy, delay);
        }

        function drawPlayer() {
            if (state.invuln > 0 && state.frame % 6 < 3) return; 
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.shadowBlur = 25; ctx.shadowColor = '#00f2ff';
            ctx.strokeStyle = '#00f2ff'; ctx.lineWidth = 4;
            ctx.fillStyle = 'rgba(0, 242, 255, 0.1)';
            ctx.beginPath();
            ctx.moveTo(0, -25); ctx.lineTo(20, 20); ctx.lineTo(0, 10); ctx.lineTo(-20, 20);
            ctx.closePath();
            ctx.fill(); ctx.stroke();
            ctx.fillStyle = '#ff3131'; ctx.shadowColor = '#ff3131';
            ctx.beginPath(); ctx.arc(0, 15, 5 + Math.sin(state.frame*0.5)*2, 0, Math.PI*2); ctx.fill();
            ctx.restore();
        }

        function update() {
            if(!state.active) return requestAnimationFrame(update);
            if(state.paused) return requestAnimationFrame(update);

            state.frame++;
            if(state.invuln > 0) state.invuln--;

            ctx.fillStyle = '#010103'; ctx.fillRect(0, 0, width, height);

            stars.forEach(s => {
                s.y += s.v * state.timeScale; if(s.y > height) s.y = 0;
                ctx.fillStyle = '#fff3'; ctx.fillRect(s.x, s.y, s.s, s.s);
            });

            player.x += (mouseX - player.x) * player.speedMult;
            player.y += (mouseY - player.y) * player.speedMult;

            if(state.frame % Math.floor(player.fireRate) === 0) {
                for(let i=0; i<player.bulletCount; i++) {
                    const angle = (i - (player.bulletCount-1)/2) * 0.15;
                    bullets.push(new Bullet(player.x, player.y - 20, angle));
                }
            }

            bullets = bullets.filter(b => {
                b.update(); b.draw();
                return b.y > -50 && b.x > -50 && b.x < width + 50;
            });

            particles = particles.filter(p => {
                p.update(); p.draw();
                return p.life > 0;
            });

            enemies.forEach((e, ei) => {
                e.update(); e.draw();
                
                bullets.forEach((b, bi) => {
                    if(!b.hitEnemies.has(e) && Math.hypot(b.x-e.x, b.y-e.y) < e.radius + b.radius) {
                        e.hp -= b.dmg;
                        b.hitEnemies.add(e);
                        for(let i=0; i<5; i++) particles.push(new Particle(e.x, e.y, e.color));
                        if(b.pierceCount <= 0) bullets.splice(bi, 1);
                        else b.pierceCount--;

                        if(e.hp <= 0) {
                            state.xp += e.isHeavy ? 60 : 25; 
                            state.score += e.isHeavy ? 500 : 100;
                            enemies.splice(ei, 1);
                            document.getElementById('score-display').innerText = state.score;
                            
                            if(state.xp >= state.xpToNext) {
                                state.xp -= state.xpToNext; state.level++; 
                                state.xpToNext = Math.floor(state.xpToNext * 1.3);
                                document.getElementById('level-display').innerText = state.level;
                                showLevelUp();
                            }
                            document.getElementById('xp-fill').style.width = Math.min(100, (state.xp/state.xpToNext*100))+'%';
                        }
                    }
                });

                if(state.invuln === 0 && Math.hypot(player.x-e.x, player.y-e.y) < e.radius*0.8 + player.radius) {
                    state.lives--; state.invuln = 120;
                    updateLives();
                    for(let i=0; i<20; i++) particles.push(new Particle(player.x, player.y, '#00f2ff'));
                    if(state.lives <= 0) gameOver();
                }
                if(e.y > height + 100) enemies.splice(ei, 1);
            });

            drawPlayer();
            requestAnimationFrame(update);
        }

        function updateLives() {
            document.getElementById('lives-display').innerText = '‚ù§Ô∏è'.repeat(Math.max(0, state.lives));
        }

        function gameOver() {
            state.active = false;
            document.getElementById('game-over-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = `TOTAL COMBAT DATA: ${state.score}`;
        }

        document.getElementById('start-btn').onclick = () => {
            const name = document.getElementById('player-input').value.trim() || "GHOST";
            document.getElementById('pilot-name').innerText = name.toUpperCase();
            document.getElementById('start-screen').classList.add('hidden');
            state.active = true;
            mouseX = width/2; mouseY = height*0.8;
            update();
        };

        document.getElementById('restart-btn').onclick = () => location.reload();

        window.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; });
        window.addEventListener('touchstart', e => { if(e.touches.length) { mouseX = e.touches[0].clientX; mouseY = e.touches[0].clientY; } });
        window.addEventListener('touchmove', e => {
            if(e.touches.length) { mouseX = e.touches[0].clientX; mouseY = e.touches[0].clientY; }
            e.preventDefault();
        }, {passive: false});

        spawnEnemy();
    </script>
</body>
</html>

